# =============================================================================
# JotTick HOME ASSISTANT INTEGRATION VIA HACS
# These helpers MUST be created for JotTick to work properly
# Go to Settings > Devices & Services > Helpers > Create Helper
# Create each helper exactly as specified below
# =============================================================================

#under input_text
input_text:
#under input_text
  jottick_due_date_action_data:
    name: "Due Date Action Data"
    initial: ""
    max: 255
    icon: mdi:calendar-edit

  jottick_editing_reminder_id:
    name: "Editing Reminder ID"
    initial: ""
    max: 255

  jottick_editing_reminder_type:
    name: "Editing Reminder Type"
    initial: ""
    max: 20

  jottick_editing_reminder_title:
    name: "Editing Reminder Title"
    initial: ""
    max: 255
    
  jottick_note_id:
    name: "Note ID"
    initial: ""
    max: 255

  jottick_quick_action_data:
    name: Quick Action Data
    max: 255
    icon: mdi:cog

  jottick_note_title:
    name: "Note Title"
    initial: ""
    max: 255

  jottick_note_content:
    name: "Note Content"
    initial: ""
    max: 255
    mode: text

  jottick_edit_note_content:
    name: "Edit Note Content"
    initial: ""
    max: 255
    mode: text

  jottick_edit_note_title:
    name: "Edit Note Title"
    initial: ""
    max: 255

  jottick_checklist_id:
    name: "Checklist ID"
    initial: ""
    max: 255

  jottick_checklist_title:
    name: "Checklist Title"
    initial: ""
    max: 255

  jottick_task_title:
    name: "Task Title"
    initial: ""
    max: 255
    
  jottick_selected_checklist_id:
    name: "Selected Checklist ID"
    initial: ""
    max: 255

  jottick_selected_checklist_title:
    name: "Selected Checklist Title"
    initial: ""
    max: 255

  jottick_selected_checklist_type:
    name: "Selected Checklist Type"
    initial: "simple"
    max: 50

  jottick_item_text:
    name: "Item Text"
    initial: ""
    max: 255

  jottick_loading_item:
    name: "Loading Item"
    initial: ""
    max: 100

  jottick_quick_task_action_data:
    name: Quick Task Action Data
    max: 255
    icon: mdi:clipboard-list

  jottick_quick_delete_item_data:
    name: Quick Delete Item Data
    max: 255
    icon: mdi:delete

  jottick_selected_task_id:
    name: "Selected Task ID"
    initial: ""
    max: 255

  jottick_selected_task_title:
    name: "Selected Task Title"
    initial: ""
    max: 255

  jottick_task_item_text:
    name: "Task Item Text"
    initial: ""
    max: 255

  jottick_new_status_id:
    name: "New Status ID"
    initial: ""
    max: 50
    icon: mdi:identifier

  jottick_new_status_label:
    name: "New Status Label"
    initial: ""
    max: 100
    icon: mdi:label

  jottick_new_status_color:
    name: "New Status Color"
    initial: "#3b82f6"
    max: 20
    icon: mdi:palette

  jottick_edit_status_id:
    name: "Edit Status ID"
    initial: ""
    max: 50

  jottick_edit_status_label:
    name: "Edit Status Label"
    initial: ""
    max: 100

  jottick_edit_status_color:
    name: "Edit Status Color"
    initial: ""
    max: 20

  jottick_kanban_action_data:
    name: Kanban Action Data
    max: 255
    icon: mdi:view-column

  jottick_parent_item_index:
    name: "Parent Item Index"
    initial: ""
    max: 50
    icon: mdi:file-tree    

  jottick_calendar_color_note_created:
    name: "Calendar Color - Note Created"
    initial: "#9CCAEB"
    max: 20
    icon: mdi:palette

  jottick_calendar_color_note_edited:
    name: "Calendar Color - Note Edited"
    initial: "#6BA5D4"
    max: 20
    icon: mdi:palette

  jottick_calendar_color_note_reminder:
    name: "Calendar Color - Note Reminder"
    initial: "#F7A700"
    max: 20
    icon: mdi:palette

  jottick_calendar_color_list_created:
    name: "Calendar Color - List Created"
    initial: "#99C66D"
    max: 20
    icon: mdi:palette

  jottick_calendar_color_list_edited:
    name: "Calendar Color - List Edited"
    initial: "#7AAD52"
    max: 20
    icon: mdi:palette

  jottick_calendar_color_list_due:
    name: "Calendar Color - List Due"
    initial: "#10B981"
    max: 20
    icon: mdi:palette

  jottick_calendar_color_task_due:
    name: "Calendar Color - Task Due"
    initial: "#F9E900"
    max: 20
    icon: mdi:palette

  jottick_calendar_color_task_overdue:
    name: "Calendar Color - Task Overdue"
    initial: "#EF4444"
    max: 20
    icon: mdi:palette

  jottick_calendar_color_imported:
    name: "Calendar Color - Imported Events"
    initial: "#A855F7"
    max: 20
    icon: mdi:palette

  jottick_calendar_color_completed:
    name: "Calendar Color - Completed Items"
    initial: "#6B7280"
    max: 20
    icon: mdi:palette

  jottick_calendar_popup_event_data:
    name: "Calendar Popup Event Data"
    initial: ""
    max: 255
    icon: mdi:calendar

  jottick_calendar_export_filename:
    name: "Calendar Export Filename"
    initial: "jottick_calendar"
    max: 100
    icon: mdi:file-export

  jottick_ical_import_url:
    name: "iCal Import URL"
    initial: ""
    max: 255
    icon: mdi:calendar-import

  jottick_ical_import_name:
    name: "iCal Import Name"
    initial: ""
    max: 100
    icon: mdi:calendar

  jottick_points_new_user_name:
    name: "New Points User Name"
    initial: ""
    max: 100
    icon: mdi:account-plus

  jottick_points_adjust_amount:
    name: "Points Adjust Amount"
    initial: ""
    max: 20
    icon: mdi:plus-minus

  jottick_points_adjust_reason:
    name: "Points Adjust Reason"
    initial: ""
    max: 255
    icon: mdi:text

  jottick_points_new_prize_name:
    name: "New Prize Name"
    initial: ""
    max: 100
    icon: mdi:gift

  jottick_points_new_prize_description:
    name: "New Prize Description"
    initial: ""
    max: 255
    icon: mdi:text

  jottick_points_action_data:
    name: "Points Action Data"
    initial: ""
    max: 255
    icon: mdi:star

  jottick_points_selected_user_id:
    name: "Selected Points User ID"
    initial: ""
    max: 100
    icon: mdi:account

  jottick_points_selected_prize_id:
    name: "Selected Prize ID"
    initial: ""
    max: 100
    icon: mdi:gift

#under input_select
input_select:
#under input_select
  jottick_reminder_target:
    name: "Remind Who"
    options:
      - "Nobody"
    initial: "Nobody"
    icon: mdi:account-bell

  jottick_reminder_interval:
    name: "Remind Every"
    options:
      - "30 minutes"
      - "1 hour"
      - "2 hours"
      - "4 hours"
      - "8 hours"
      - "12 hours"
      - "Once a day"
    initial: "1 hour"
    icon: mdi:timer-outline

  jottick_reminder_days:
    name: "On Days"
    options:
      - "Weekdays"
      - "Weekends"
      - "Every day"
    initial: "Weekdays"
    icon: mdi:calendar-week
    
  jottick_status_picker:
    name: "Status Column Picker"
    options:
      - "-- Select status --"
    initial: "-- Select status --"
    icon: mdi:view-column

  jottick_checklist_type:
    name: "Checklist Type"
    options:
      - "simple"
      - "task"
    initial: "simple"

  jottick_task_status:
    name: "Task Status"
    options:
      - "todo"
      - "in_progress"
      - "paused"
      - "completed"
    initial: "todo"

  jottick_note_picker:
    name: "Note Picker"
    options:
      - "-- Pick a note --"
    initial: "-- Pick a note --"

  jottick_checklist_picker:
    name: "Checklist Picker"
    options:
      - "-- Pick a checklist --"
    initial: "-- Pick a checklist --"

  jottick_item_picker:
    name: "Item Picker"
    options:
      - "-- Select item --"
    initial: "-- Select item --"

  jottick_task_picker:
    name: "Task Picker"
    options:
      - "-- Pick a task list --"
    initial: "-- Pick a task list --"

  jottick_task_item_picker:
    name: "Task Item Picker"
    options:
      - "-- Select task item --"
    initial: "-- Select task item --"

  jottick_new_task_item_status:
    name: "New Task Item Status"
    options:
      - "todo"
      - "in_progress"
      - "completed"
    initial: "todo"
    
  jottick_item_status:
    name: "Item Status"
    options:
      - "-- Select status --"
      - "todo"
      - "in_progress"
      - "paused"
      - "completed"
    initial: "-- Select status --"

  jottick_calendar_view:
    name: "Calendar View"
    options:
      - "month"
      - "week"
    initial: "month"
    icon: mdi:calendar-month

  jottick_calendar_week_start:
    name: "Calendar Week Start"
    options:
      - "sunday"
      - "monday"
    initial: "sunday"
    icon: mdi:calendar-week

  jottick_calendar_default_event_display:
    name: "Default Event Display"
    options:
      - "all_day"
      - "morning"
      - "custom"
    initial: "all_day"
    icon: mdi:clock-outline

  jottick_points_user_picker:
    name: "Points User Picker"
    options:
      - "-- Select user --"
    initial: "-- Select user --"
    icon: mdi:account

  jottick_points_claim_user:
    name: "Claim For User"
    options:
      - "-- Select user --"
    initial: "-- Select user --"
    icon: mdi:account-check

#under input_number 
input_number:
#under input_number 

  jottick_selected_item_index:
    name: "Selected Item Index"
    min: 0
    max: 1000
    step: 1
    initial: 0
    mode: box

  jottick_new_status_order:
    name: "New Status Order"
    initial: 0
    min: 0
    max: 20
    step: 1
    mode: box
    icon: mdi:sort-numeric-ascending  

  jottick_calendar_default_time_hour:
    name: "Default Event Time (Hour)"
    initial: 9
    min: 0
    max: 23
    step: 1
    mode: box
    icon: mdi:clock-outline

  jottick_calendar_default_time_minute:
    name: "Default Event Time (Minute)"
    initial: 0
    min: 0
    max: 59
    step: 15
    mode: box
    icon: mdi:clock-outline

  jottick_points_default_list_item:
    name: "Default Points - List Items"
    initial: 0
    min: 0
    max: 1000
    step: 1
    mode: box
    icon: mdi:star

  jottick_points_default_task_item:
    name: "Default Points - Task Items"
    initial: 0
    min: 0
    max: 1000
    step: 1
    mode: box
    icon: mdi:star

  jottick_points_new_prize_cost:
    name: "New Prize Cost"
    initial: 100
    min: 1
    max: 100000
    step: 1
    mode: box
    icon: mdi:currency-usd

#under input_boolean    
input_boolean:
#under input_boolean  

  jottick_calendar_show_note_created:
    name: "Show Note Created"
    initial: true
    icon: mdi:note-plus

  jottick_calendar_show_note_edited:
    name: "Show Note Edited"
    initial: true
    icon: mdi:note-edit

  jottick_calendar_show_note_reminders:
    name: "Show Note Reminders"
    initial: true
    icon: mdi:bell

  jottick_calendar_show_list_created:
    name: "Show List Created"
    initial: true
    icon: mdi:playlist-plus

  jottick_calendar_show_list_edited:
    name: "Show List Edited"
    initial: true
    icon: mdi:playlist-edit

  jottick_calendar_show_list_due:
    name: "Show List Due Dates"
    initial: true
    icon: mdi:calendar-check

  jottick_calendar_show_task_due:
    name: "Show Task Due Dates"
    initial: true
    icon: mdi:calendar-clock

  jottick_calendar_show_imported:
    name: "Show Imported Events"
    initial: true
    icon: mdi:calendar-import

  jottick_calendar_show_overdue:
    name: "Show Overdue Items"
    initial: true
    icon: mdi:calendar-alert

  jottick_calendar_show_completed:
    name: "Show Completed Items"
    initial: false
    icon: mdi:check-circle

  jottick_hide_completed_list_items:
    name: "Hide Completed List Items"
    initial: false
    icon: mdi:checkbox-marked-outline

  jottick_hide_completed_task_items:
    name: "Hide Completed Task Items"
    initial: false
    icon: mdi:clipboard-check-outline

  jottick_show_calendar_event_popup:
    name: "Show Calendar Event Popup"
    initial: false
    icon: mdi:popup

  jottick_item_completed:
    name: "Item Completed"
    initial: false

  jottick_is_loading:
    name: "Is Loading"
    initial: false
    icon: mdi:loading

  jottick_enable_reminder:
    name: "Enable Reminder"
    initial: false
    icon: mdi:bell-plus

  jottick_show_reminder_popup:
    name: "Show Reminder Popup"
    initial: false
    icon: mdi:popup

  jottick_points_enabled:
    name: "Enable Points System"
    icon: mdi:star-circle

  jottick_points_show_on_lists:
    name: "Show Points on List Items"
    initial: true
    icon: mdi:format-list-checks

  jottick_points_show_on_tasks:
    name: "Show Points on Task Items"
    initial: true
    icon: mdi:clipboard-list

  jottick_points_allow_self_claim:
    name: "Allow Self-Claim"
    initial: true
    icon: mdi:hand-pointing-up

  jottick_points_show_leaderboard:
    name: "Show Leaderboard"
    initial: true
    icon: mdi:podium

  jottick_points_show_history:
    name: "Show Points History"
    initial: true
    icon: mdi:history

  jottick_points_show_edit_user_popup:
    name: "Show Edit User Popup"
    initial: false
    icon: mdi:account-edit

  jottick_points_show_add_prize_popup:
    name: "Show Add Prize Popup"
    initial: false
    icon: mdi:gift-outline

  jottick_points_show_redeem_popup:
    name: "Show Redeem Popup"
    initial: false
    icon: mdi:gift-open

#under input_datetime    
input_datetime:    
#under input_datetime 
  jottick_reminder_start:
    name: "From Time"
    has_date: false
    has_time: true

  jottick_reminder_end:
    name: "Until Time"
    has_date: false
    has_time: true

  jottick_calendar_selected_date:
    name: "Selected Calendar Date"
    has_date: true
    has_time: false

    
template:

  - trigger:
      - platform: homeassistant
        event: start
      - platform: event
        event_type: jottick_reminder_update
    sensor:
      - name: "JotTick Reminders"
        unique_id: jottick_reminders_storage
        state: >
          {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.configs is defined %}
            {{ trigger.event.data.configs | length }}
          {% else %}
            {{ this.attributes.configs | default({}) | length }}
          {% endif %}
        attributes:
          configs: >
            {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.configs is defined %}
              {{ trigger.event.data.configs }}
            {% else %}
              {{ this.attributes.configs | default({}) }}
            {% endif %}
            
  - trigger:
      - platform: homeassistant
        event: start
      - platform: time_pattern
        minutes: "/30"
    sensor:
      - name: "JotTick Available Notifiers"
        unique_id: jottick_available_notifiers
        state: "{{ this.attributes.notifiers | default([]) | length }}"
        attributes:
          notifiers: >
            {% set ns = namespace(services=[], seen=[]) %}
            {% for s in states.sensor %}
              {% if s.entity_id.endswith('_battery_level') or s.entity_id.endswith('_battery_state') %}
                {% set base = s.entity_id | replace('sensor.', '') | replace('_battery_level', '') | replace('_battery_state', '') %}
                {% if base not in ns.seen %}
                  {% set ns.services = ns.services + ['notify.mobile_app_' ~ base] %}
                  {% set ns.seen = ns.seen + [base] %}
                {% endif %}
              {% endif %}
            {% endfor %}
            {% if ns.services | length == 0 %}
              {% for state in states.device_tracker %}
                {% if state.attributes.source_type is defined and state.attributes.source_type == 'gps' %}
                  {% set device_name = state.object_id %}
                  {% if device_name not in ns.seen %}
                    {% set ns.services = ns.services + ['notify.mobile_app_' ~ device_name] %}
                    {% set ns.seen = ns.seen + [device_name] %}
                  {% endif %}
                {% endif %}
              {% endfor %}
            {% endif %}
            {{ ns.services | unique | list }}

  - trigger:
      - platform: homeassistant
        event: start
      - platform: event
        event_type: jottick_recurring_update
    sensor:
      - name: "JotTick Recurring"
        unique_id: jottick_recurring_storage
        state: >
          {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.configs is defined %}
            {{ trigger.event.data.configs | length }}
          {% else %}
            {{ this.attributes.configs | default({}) | length }}
          {% endif %}
        attributes:
          configs: >
            {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.configs is defined %}
              {{ trigger.event.data.configs }}
            {% else %}
              {{ this.attributes.configs | default({}) }}
            {% endif %}

  - trigger:
      - platform: homeassistant
        event: start
      - platform: event
        event_type: jottick_scheduled_notes_update
    sensor:
      - name: "JotTick Scheduled Notes"
        unique_id: jottick_scheduled_notes_storage
        state: >
          {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.schedules is defined %}
            {{ trigger.event.data.schedules | length }}
          {% else %}
            {{ this.attributes.schedules | default({}) | length }}
          {% endif %}
        attributes:
          schedules: >
            {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.schedules is defined %}
              {{ trigger.event.data.schedules }}
            {% else %}
              {{ this.attributes.schedules | default({}) }}
            {% endif %}          
            
  - trigger:
      - platform: homeassistant
        event: start
      - platform: event
        event_type: jottick_user_devices_update
    sensor:
      - name: "JotTick User Devices"
        unique_id: jottick_user_devices
        state: >
          {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.user_devices is defined %}
            {{ trigger.event.data.user_devices | length }} users
          {% elif this.attributes is defined and this.attributes.user_devices is defined %}
            {{ this.attributes.user_devices | length }} users
          {% else %}
            0 users
          {% endif %}
        attributes:
          user_devices: >
            {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.user_devices is defined %}
              {{ trigger.event.data.user_devices }}
            {% elif this.attributes is defined and this.attributes.user_devices is defined %}
              {{ this.attributes.user_devices }}
            {% else %}
              {}
            {% endif %}

  - trigger:
      - platform: homeassistant
        event: start
      - platform: event
        event_type: jottick_aliases_update
    sensor:
      - name: "JotTick Reminder Aliases"
        unique_id: jottick_reminder_aliases
        state: >
          {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.aliases is defined %}
            {{ trigger.event.data.aliases | length }} aliases
          {% elif this.attributes is defined and this.attributes.aliases is defined %}
            {{ this.attributes.aliases | length }} aliases
          {% else %}
            0 aliases
          {% endif %}
        attributes:
          aliases: >
            {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.aliases is defined %}
              {{ trigger.event.data.aliases }}
            {% elif this.attributes is defined and this.attributes.aliases is defined %}
              {{ this.attributes.aliases }}
            {% else %}
              {}
            {% endif %}

  - trigger:
      - platform: homeassistant
        event: start
      - platform: event
        event_type: jottick_points_users_update
    sensor:
      - name: "JotTick Points Users"
        unique_id: jottick_points_users
        state: >
          {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.users is defined %}
            {{ trigger.event.data.users | length }} users
          {% elif this.attributes is defined and this.attributes.users is defined %}
            {{ this.attributes.users | length }} users
          {% else %}
            0 users
          {% endif %}
        attributes:
          users: >
            {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.users is defined %}
              {{ trigger.event.data.users }}
            {% elif this.attributes is defined and this.attributes.users is defined %}
              {{ this.attributes.users }}
            {% else %}
              {}
            {% endif %}

  - trigger:
      - platform: homeassistant
        event: start
      - platform: event
        event_type: jottick_points_history_update
    sensor:
      - name: "JotTick Points History"
        unique_id: jottick_points_history
        state: >
          {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.history is defined %}
            {{ trigger.event.data.history | length }} entries
          {% elif this.attributes is defined and this.attributes.history is defined %}
            {{ this.attributes.history | length }} entries
          {% else %}
            0 entries
          {% endif %}
        attributes:
          history: >
            {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.history is defined %}
              {{ trigger.event.data.history }}
            {% elif this.attributes is defined and this.attributes.history is defined %}
              {{ this.attributes.history }}
            {% else %}
              []
            {% endif %}

  - trigger:
      - platform: homeassistant
        event: start
      - platform: event
        event_type: jottick_points_prizes_update
    sensor:
      - name: "JotTick Points Prizes"
        unique_id: jottick_points_prizes
        state: >
          {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.prizes is defined %}
            {{ trigger.event.data.prizes | length }} prizes
          {% elif this.attributes is defined and this.attributes.prizes is defined %}
            {{ this.attributes.prizes | length }} prizes
          {% else %}
            0 prizes
          {% endif %}
        attributes:
          prizes: >
            {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.prizes is defined %}
              {{ trigger.event.data.prizes }}
            {% elif this.attributes is defined and this.attributes.prizes is defined %}
              {{ this.attributes.prizes }}
            {% else %}
              []
            {% endif %}

  - trigger:
      - platform: homeassistant
        event: start
      - platform: event
        event_type: jottick_points_admins_update
    sensor:
      - name: "JotTick Points Admins"
        unique_id: jottick_points_admins
        state: >
          {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.admins is defined %}
            {{ trigger.event.data.admins | length }} admins
          {% elif this.attributes is defined and this.attributes.admins is defined %}
            {{ this.attributes.admins | length }} admins
          {% else %}
            0 admins
          {% endif %}
        attributes:
          admins: >
            {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.admins is defined %}
              {{ trigger.event.data.admins }}
            {% elif this.attributes is defined and this.attributes.admins is defined %}
              {{ this.attributes.admins }}
            {% else %}
              []
            {% endif %}

  - trigger:
      - platform: homeassistant
        event: start
      - platform: event
        event_type: jottick_achievements_update
    sensor:
      - name: "JotTick Achievements"
        unique_id: jottick_achievements
        state: >
          {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.achievements is defined %}
            {{ trigger.event.data.achievements | length }} achievements
          {% elif this.attributes is defined and this.attributes.achievements is defined %}
            {{ this.attributes.achievements | length }} achievements
          {% else %}
            0 achievements
          {% endif %}
        attributes:
          achievements: >
            {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.achievements is defined %}
              {{ trigger.event.data.achievements }}
            {% elif this.attributes is defined and this.attributes.achievements is defined %}
              {{ this.attributes.achievements }}
            {% else %}
              []
            {% endif %}

  - trigger:
      - platform: homeassistant
        event: start
      - platform: event
        event_type: jottick_user_achievements_update
    sensor:
      - name: "JotTick User Achievements"
        unique_id: jottick_user_achievements
        state: >
          {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.user_achievements is defined %}
            {{ trigger.event.data.user_achievements | length }} users
          {% elif this.attributes is defined and this.attributes.user_achievements is defined %}
            {{ this.attributes.user_achievements | length }} users
          {% else %}
            0 users
          {% endif %}
        attributes:
          user_achievements: >
            {% if trigger.platform == 'event' and trigger.event is defined and trigger.event.data is defined and trigger.event.data.user_achievements is defined %}
              {{ trigger.event.data.user_achievements }}
            {% elif this.attributes is defined and this.attributes.user_achievements is defined %}
              {{ this.attributes.user_achievements }}
            {% else %}
              {}
            {% endif %}